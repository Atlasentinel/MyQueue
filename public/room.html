<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/styles/style.css" />
  <title>MyQueue</title>
</head>

<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.11.0/qs.min.js"
    integrity="sha512-/l6vieC+YxaZywUhmqs++8uF9DeMvJE61ua5g+UK0TuHZ4TkTgB1Gm1n0NiA86uEOM9JJ6JUwyR0hboKO0fCng=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script >

      const socket = io("localhost:3000");
      
    
        console.log("connect√© room");

      socket.on('users', (data) => {
        console.log("utilisateur: ", data);
      });
   
          socket.on("users", (data) =>{
             truc = $("#ulParticipant").append($("<li>").text(data));
        });

        
  </script>

  </script>
  <header>
    <nav>
      <ul class="ulangue">
        <li class="Langue">
          <select>
            <option value="">Langue</option>
            <option value="English">English</option>
            <option value="Fran√ßais">Fran√ßais</option>
          </select>
        </li>
        <li class="Update" onclick="modal('popup')">üîî New Update üîî</li>
        <div class="popup">
          <div class="popup-container">
            <h1>Version 1.0</h1>
            <h3><u>Quoi de neuf : </u></h3>
            <ul class="brip">
              <li>J'ai √† finir le css</li>
              <li>Gestion des liens de soundcloud</li>
              <li>Gestion des liens de spotify</li>
            </ul>
          </div>

          <span class="closepup">Okay</span>
        </div>
      </ul>
    </nav>
  </header>
  <div class="room-container">
    <div class="user-room">
      <span class="user-text">Participants de Guest</span><br>
      <ul id="ulParticipant" class="ulParticipant">

      </ul>
    </div>

    <div class="music-queue-container">
      <div class="music-queue-text">
        <span>Music in Queue</span>
      </div>
      <div class="music-queue">
        <ul class="ul-music">
          <li class="li-music">
            <div class="music">
              <div class="img"><img src="images/test.jpg" /></div>
              <div class="music-text">
                <span>Oboy - Avec Toi [2:30]</span>
              </div>
              <div class="music-delete">
                <span id="delete"><i class="bx bx-x bx-rotate-180"></i></span>
              </div>
            </div>
          </li>
          
        </ul>

      
      </div>

      <audio id="audio-player"></audio>


 


      <script>
        socket.on('music-list', (data) => {
        const musicList = data.musicList;
        const list = document.createElement('ul');
        musicList.forEach((music) => {
          const item = document.createElement('li');
          item.textContent = `${music.urlMusic}`;
          list.appendChild(item);
        });
        document.body.appendChild(list);
      });
      </script>

      <div class="music-queue-input">
        <form id="test" method="POST" action="javascript:send()">
          <input id="send-music" autocomplete="off" type="text" placeholder="Mettre un url..." />
        </form>
      </div>

            
      <script>
        const form = document.querySelector('#test');
        const urlMusic = document.querySelector('#send-music');

        function send(){

          const music = urlMusic.value;
          if(music != "https://www.youtube.com/watch?v=LfqVVOsQ9Wg"){
            console.log("Lien incorrect");
            return;
          }
          socket.emit('add-music', { music });
          window.location.href =
          "room";
        }
              </script>

    </div>
  </div>
<!--<a href="./" title="Exit">
          <span class="exit">
            <i class="bx bx-exit"></i>

            <span class="exit-text">Quitter le salon</span>
          </span>
        </a>-->

        <button onclick="playYouTubeVideo('https://www.youtube.com/watch?v=dQw4w9WgXcQ')">
          Lire la vid√©o
        </button>
        <script>

          const AUDIO_PLAYER_ID = 'audio-player';
          // Fonction qui charge et joue la vid√©o YouTube
          function playYouTubeVideo(videoUrl) {
            // R√©cup√®re l'ID de la vid√©o √† partir de l'URL
            const videoId = getYouTubeVideoId(videoUrl);
            // Cr√©e l'URL de la source de l'audio √† partir de l'ID de la vid√©o
            const audioUrl = `https://www.youtube.com/watch?v=${videoId}`;
            // R√©cup√®re l'√©l√©ment audio
            const audioPlayer = document.getElementById(AUDIO_PLAYER_ID);
            // Modifie la source de l'audio
            audioPlayer.src = audioUrl;
            // Charge et joue l'audio
            audioPlayer.load();
            audioPlayer.play();
          }
          
          // Fonction qui r√©cup√®re l'ID de la vid√©o YouTube √† partir de l'URL
          function getYouTubeVideoId(videoUrl) {
            const regex = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = videoUrl.match(regex);
            return (match && match[2].length === 11) ? match[2] : null;
          }
  
        </script>
  <div class="footer">
    <p>MyQueue &copy; - 2022 Tous Droits R√©serv√©s</p>
  </div>

  <script src="js/main.js"></script>
</body>

</html>
